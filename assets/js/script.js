// example questions were generated by chatGPT from a prompt I entered, cited in README
const questions = [
    {
        question: "What does 'HTML' stand for?",
        answers: [
            { option: 'Hyper Text Markup Language', correct: true },
            { option: 'Hyperlink and Text Markup Language', correct: false },
            { option: 'Highly Typed Markup Language', correct: false },
            { option: 'Home Tool Markup Language', correct: false },
        ],
    },
    {
        question: "Which keyword is used to declare a variable in JavaScript?",
        answers: [
            { option: 'var', correct: true },
            { option: 'let', correct: false },
            { option: 'const', correct: false },
            { option: 'variable', correct: false },
        ],
    },
    {
        question: "What is the result of '5 + '5' in JavaScript?",
        answers: [
            { option: '10', correct: false },
            { option: '55', correct: true },
            { option: '5 + 5', correct: false },
            { option: 'Error', correct: false },
        ],
    } //,
    // {
    //     question: "Which function is used to print something to the console in JavaScript?",
    //     answers: [
    //         { option: 'print()', correct: false },
    //         { option: 'log()', correct: false },
    //         { option: 'console.log()', correct: true },
    //         { option: 'display()', correct: false },
    //     ],
    // },
    // {
    //     question: "What is the value of 'null' in JavaScript?",
    //     answers: [
    //         { option: '0', correct: false },
    //         { option: 'undefined', correct: false },
    //         { option: 'false', correct: false },
    //         { option: 'null', correct: true },
    //     ],
    // },
    // {
    //     question: "What does 'NaN' stand for in JavaScript?",
    //     answers: [
    //         { option: 'Not a Number', correct: true },
    //         { option: 'No Available Number', correct: false },
    //         { option: 'Notation of Number', correct: false },
    //         { option: 'No Action Needed', correct: false },
    //     ],
    // },
    // {
    //     question: "Which loop is used for iterating over the properties of an object?",
    //     answers: [
    //         { option: 'for loop', correct: false },
    //         { option: 'while loop', correct: false },
    //         { option: 'for...in loop', correct: true },
    //         { option: 'do...while loop', correct: false },
    //     ],
    // },
    // {
    //     question: "What is the result of '3 === '3' in JavaScript?",
    //     answers: [
    //         { option: 'true', correct: false },
    //         { option: 'false', correct: true },
    //         { option: 'undefined', correct: false },
    //         { option: 'null', correct: false },
    //     ],
    // },
    // {
    //     question: "Which operator is used to combine two or more strings in JavaScript?",
    //     answers: [
    //         { option: '+', correct: true },
    //         { option: '-', correct: false },
    //         { option: '*', correct: false },
    //         { option: '/', correct: false },
    //     ],
    // },
    // {
    //     question: "What is the correct way to write a comment in JavaScript?",
    //     answers: [
    //         { option: '// This is a comment', correct: true },
    //         { option: '<!-- This is a comment -->', correct: false },
    //         { option: '/* This is a comment */', correct: false },
    //         { option: '# This is a comment', correct: false },
    //     ],
    // },
];

// DOM selector variables
const startButtonEl = document.getElementById('start');
const nextButtonEl = document.getElementById('next');
const startPageEl = document.getElementById('start-page');
const questionPageEl = document.getElementById('question-container');
const questionEl = document.getElementById('question');
const answerChoicesEl = document.getElementById('answer-choices');
const countdownEl = document.getElementById('shot-clock');
const highScoreEl = document.getElementById('high-score');
const endPageEl = document.getElementById('end-page');
const userScoreEl = document.getElementById('user-score');
const highScorePageEl = document.getElementById('high-score-page');
const postScoreBtnEl = document.getElementById('post-score');
const userNameEl = document.getElementById('user-name');
const clearScoresEl = document.getElementById('clear-scores');
const scoreListEl = document.getAnimations('scores-list');

// general variables
let randomQuestions; 
let questionIndex;
let ptsPerQuestion = 100/questions.length;
let userPts;
let quizFinished = false;
let timer;
let secondsLeft = 61;
let highScores = [];

// functions
function startQuiz() {
    countdownEl.classList.remove('not-visible');
    startPageEl.classList.add('not-visible');
    startButtonEl.classList.add('not-visible');
    questionPageEl.classList.remove('not-visible');
    nextButtonEl.classList.remove('not-visible');
    // reset game points
    userPts = 0;
    // shuffle questions
    randomQuestions = questions.sort(() => Math.random() -0.5 ); // investigate changing random method
    setCountdownTimer();
    questionIndex = 0;
    setNextQuestion();
}

// function calculates number ofm inputs and seconds remaining and returns
function minAndSec() {
    secondsLeft--;
    let m = Math.floor(secondsLeft/60);
    let s = secondsLeft%60;
    let timeLeft = ( (m < 10) ? "0" : "" ) + m + ":" + ( (s < 10) ? "0" : "" ) + s;
    return timeLeft;
}

function setCountdownTimer() {
    timer = setInterval(function() {
        countdownEl.textContent = "Timer: " + minAndSec();
        if (secondsLeft >= 0){
            if (quizFinished){
                clearInterval(timer);
                gameOverScreen();
            }
        }
        if(secondsLeft === 0) {
            clearInterval(timer);
            gameOverScreen();
        }

    }, 1000);
}

// Show final screen with timer and high score input.
function gameOverScreen() {
    console.log("FINAL SCORE WAS: " + userPts);
    userScoreEl.textContent = "You scored " + Math.floor(userPts) + " out of 100!";
    questionPageEl.classList.add('not-visible')
    endPageEl.classList.remove('not-visible');
    // button event listener for adding to high score
    postScoreBtnEl.addEventListener('click', function(event) {
        highScores.push({user: userNameEl.value, score: userPts});
        localStorage.setItem("High Scores", JSON.stringify(highScores)); 
    });
}

function clearCard(){
    nextButtonEl.classList.add('not-visible');
    while (answerChoicesEl.firstChild) {
        answerChoicesEl.removeChild(answerChoicesEl.firstChild);
    }
}

function viewQuestion(question) {
    questionEl.innerText = question.question;
    question.answers.forEach(answer => {
        const button = document.createElement('button');
        button.innerText = answer.option;
        button.classList.add('answer-choice');
         // check if correct
         if(answer.correct){
            button.dataset.correct = answer.correct;
         }
         button.addEventListener('click', () => {
            selectAnswer(button.dataset.correct);
         }, {once: true});
         answerChoicesEl.appendChild(button);
    })
}

function setNextQuestion(){
    clearCard();
    viewQuestion(randomQuestions[questionIndex]);
}

function nextQuestion() {
    questionIndex++;
    setNextQuestion();
}

function selectAnswer(userAnswer) {
    // check if selected answer is correct
    if (userAnswer){
        userPts += ptsPerQuestion;
    } else {
        if (secondsLeft >= 5) {
            secondsLeft -= 5;
        } else {
            gameOverScreen();
        }
    }
    // assign right or wrong values answer verification    
    let choiceArr = Array.from(answerChoicesEl.children);
    choiceArr.forEach(button => {
        setClass(button, button.dataset.correct);
    });
    if (randomQuestions.length > questionIndex +1) {
        nextButtonEl.classList.remove('not-visible');
    } else {
        quizFinished = true;
    }
}

function setClass(buttonEl, correct) {
    clearClassStatus(buttonEl);
    if (correct) {
        buttonEl.classList.add('correct')
    } else {
        buttonEl.classList.add('wrong')
    }
}

function clearClassStatus(eL) {
    eL.classList.remove('correct');
    eL.classList.remove('wrong');
}

function renderScores() {
    console.log("Made it to render");
    // Clear todoList element and update todoCountSpan
    scoreListEl.innerHTML = "";
    console.log(highScores.length);
    // Render a new li for each todo
    for (let i = 0; i < highScores.length; i++) {
        let highScore = highScores[i];
        console.log("highScore: " + highScore);
        let li = document.createElement("li");
        li.textContent = highScore;
        scoreListEl.appendChild(li);
    }
}

//show high scores
function viewScores() {
    // check local storage for scores
    let storedScores = JSON.parse(localStorage.getItem("High Scores"));
    console.log(storedScores);
    if (storedScores !== null) {
        highScores = storedScores;
    }
    renderScores();
    let pages = [startPageEl, questionPageEl, endPageEl, highScorePageEl]
    pages.forEach(page => {
        if (!page.classList.contains('not-visible')) {
            let goBack = page;
            console.log("Page that was showing: " + goBack.id);
            page.classList.add('not-visible');
            startButtonEl.classList.add('not-visible');
            nextButtonEl.classList.add('not-visible');
        }
    });  
    highScorePageEl.classList.remove('not-visible');
    clearScoresEl.addEventListener('click', () => {

    });
}


// Event listener for clicking start button
startButtonEl.addEventListener('click', startQuiz);
nextButtonEl.addEventListener('click', nextQuestion);
highScoreEl.addEventListener('click', viewScores);
// GO BACK BUTTON
// CLEAR SCORES BUTTON

